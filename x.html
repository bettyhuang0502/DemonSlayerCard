<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>鬼滅抽卡模擬器</title>
</head>
<body>
  <h2>鬼滅抽卡模擬器 (單抽=50元，一抽兩張)</h2>
  <button onclick="draw()">單抽</button>
  
  <!-- 抽卡動畫影片 -->
  <video id="gachaVideo" width="480" height="270" style="display:none">
    <source src="gacha.mp4" type="video/mp4">
  </video>

  <div id="result"></div>
  <div id="cardsContainer" style="margin-top:10px;">
    <img id="cardImage1" src="" style="display:none; width:200px; height:300px; margin-right:10px;">
    <img id="cardImage2" src="" style="display:none; width:200px; height:300px;">
  </div>

  <script>
    const pool = [
      { name: "猗窩座 (最難抽)", prob: 1/18, img: "akaza.png" },
      { name: "墮姬 (第二難抽)", prob: 1/12, img: "daki.png" },
      { name: "鬼舞辻無慘 (第三難抽)", prob: 1/9, img: "muzan.png" },
      { name: "黑死牟", prob: 0.125, img: "kokushibo.png" },
      { name: "童磨", prob: 0.125, img: "douma.png" },
      { name: "憎珀天", prob: 0.125, img: "gyokko.png" },
      { name: "半天狗", prob: 0.125, img: "hundengou.png" },
      { name: "妓夫太郎", prob: 0.125, img: "jitotaro.png" },
      { name: "玉壺", prob: 0.125, img: "gyokko2.png" }
    ];

    let totalSpent = 0;
    let stats = {};
    pool.forEach(card => stats[card.name] = 0);

    function pickCard() {
      let r = Math.random();
      let acc = 0;
      for (let card of pool) {
        acc += card.prob;
        if (r < acc) {
          stats[card.name]++;
          return card.name;
        }
      }
      stats[pool[pool.length - 1].name]++;
      return pool[pool.length - 1].name;
    }

    function draw() {
      totalSpent += 50;
      let card1 = pickCard();
      let card2 = pickCard();

      let video = document.getElementById("gachaVideo");
      let container = document.getElementById("result");
      container.innerHTML = "";        // 清空之前的結果
      video.style.display = "block";   // 顯示影片
      video.currentTime = 0;           // 從頭播放
      video.play();

      // 當影片播完 → 顯示抽卡結果與圖片
      video.onended = function() {
        video.style.display = "none";  // 播完隱藏影片

        let output = `<b>累積消費:</b> ${totalSpent} 元<br>`;
        output += `<b>這次抽到:</b> ${card1}, ${card2}<br><br>`;

        output += "<b>統計結果:</b><br>";
        for (let card in stats) {
          output += `${card}: ${stats[card]} 次<br>`;
        }
        container.innerHTML = output;

        // 顯示兩張卡片圖片
        let cardObj1 = pool.find(c => c.name === card1);
        let cardObj2 = pool.find(c => c.name === card2);

        let img1 = document.getElementById("cardImage1");
        let img2 = document.getElementById("cardImage2");

        img1.src = cardObj1.img;
        img2.src = cardObj2.img;

        img1.style.display = "inline-block";
        img2.style.display = "inline-block";
      };
    }
  </script>
</body>
</html>
